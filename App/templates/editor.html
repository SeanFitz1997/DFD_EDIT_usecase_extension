{% from "_save_modal.html" import save_modal with context %}
{% extends "_base.html" %} {% block content %}
<div id="editor">

	<!-- Toolbar -->
	<div id="toolbar">
		<div class="mt-3 mb-3 text-center">
			<h5><span class="badge badge-light">Add to graph</span></h5>
		</div>
		<hr />
		<div id="toolbar_items">
			<!-- toolbar injected here -->
		</div>
		<hr />
		<div id="item_configurations">
			<div class="mt-3 mb-3 text-center">
				<h5><span class="badge badge-light">Item Configurations</span></h5>
			</div>
			<hr>
			<h5 id="item_configurations_id"></h5>
			<h5 id="item_configurations_title"></h5>
			<button id="item_configurations_add_sub_diagram" type="button" class="btn btn-primary"
				onclick="add_diagram_button_handler()">
				Add Sub-Diagram
			</button>
		</div>
	</div>

	<!-- Graph Container -->
	<div id="graph_container">

		<!-- Title bar -->
		<div id="title_bar" class="row justify-content-between p-2 m-1 border-dark">

			<!-- Diagram title input -->
			<div class="col-4">
				{% set can_edit_title = not diagram or current_user.id == diagram.author %}
				<input id="diagram_title_input" type="text" class="form-control border border-secondary rounded"
					placeholder="Enter DFD Title ..." value="{{ diagram.title }}"
					{% if not can_edit_title %}disabled{% endif %}>
			</div>

			<!-- Diagram action buttons -->
			<div class="col-4">
				<button type="button" class="btn btn-sm btn-success" data-toggle="modal"
					data-target="#save_modal">Save</button>
				{{ save_modal() }}

				<button type="button" class="btn btn-sm btn-info" 
				onclick="export_diagram_button_handler()">Export</button>
				<button type="button" class="btn btn-sm btn-warning">Download</button>
			</div>

		</div>

		<!-- Graph -->
		<div id="graph">
			<!-- graph injected here -->
		</div>
	</div>

	<!-- Diagram hierarchy -->
	<div id="hierarchy">
		<div class="mt-3 mb-3 text-center">
			<h5><span class="badge badge-light">Diagram hierarchy</span></h5>
		</div>
		<hr />
		<ul id="hierarchy_list" class="list-group text-secondary">
			<!-- hierarchy injected here -->
		</ul>
	</div>

</div>

<!-- Load MxGraph Library -->
<script>
	mxBasePath =
		"{{ url_for('static', filename='mxgraph-master/javascript/src') }}";
</script>
<script src="{{ url_for('static', filename='mxgraph-master/javascript/src/js/mxClient.js') }}"></script>

<!-- Save Diagram -->
<script src="{{ url_for('static', filename='js/editor/save_diagram.js') }}"></script>
<!-- Diagram Validation -->
<script src="{{ url_for('static', filename='js/editor/validator.js') }}"></script>
<!-- Diagram Hierarchy -->
<script src="{{ url_for('static', filename='js/editor/diagram_hierarchy.js') }}"></script>
<!-- Editor -->
<script src="{{ url_for('static', filename='js/editor/editor.js') }}"></script>

<!-- Create Editor -->
<script>
	// TODO change to parse as string
	let loaded_hierarchy = {{hierarchy | tojson}};
	main("{{ url_for('static', filename='js/editor') }}", loaded_hierarchy);
</script>

{% endblock content %}